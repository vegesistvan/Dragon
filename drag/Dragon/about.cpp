#include "stdafx.h"
#include <iostream>
#include "Dragon.h"
#include "about.h"
#include "build_defs.h"
#include "utilities.h"

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
CAboutDlg::CAboutDlg() : CDialogEx(CAboutDlg::IDD)
{
}

void CAboutDlg::DoDataExchange(CDataExchange* pDX)
{
	CDialogEx::DoDataExchange(pDX);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
BEGIN_MESSAGE_MAP(CAboutDlg, CDialogEx)
	ON_COMMAND(IDC_STATIC, &CAboutDlg::OnStatic)
END_MESSAGE_MAP()
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
BOOL CAboutDlg::OnInitDialog()
{
	CDialogEx::OnInitDialog();

	CString BUILT;
	CString command;
	CString sqliteSourceId;
	CString sqliteVersion;
	CString str;
	CString compiled;

	const char* const COMPILED = __DATE__ " " __TIME__;
	compiled.Format( L"%s\n", MultiToUnicode(LPCSTR(COMPILED)));
	
	GetDlgItem( IDC_PROGRAM )->SetWindowText( theApp._startFileSpec );
	GetDlgItem( IDC_PLATFORM )->SetWindowText( PLATFORM );

	str.Format(L"%s - %s", theApp.m_version, MultiToUnicode(LPCSTR(BUILD)));
	GetDlgItem( IDC_STATIC_BUILT )->SetWindowText( str );
//	GetDlgItem(IDC_COMPILED)->SetWindowText(compiled);


	command = L"SELECT sqlite_source_id()";
	if( !theApp.query( command ) ) return FALSE;
	sqliteSourceId = theApp.m_recordset->GetFieldString(0);
	command = L"SELECT sqlite_version()";
	if( !theApp.query( command ) ) return FALSE;
	sqliteVersion	= theApp.m_recordset->GetFieldString(0);
	str.Format( L"%s - %s", sqliteVersion, sqliteSourceId.Left(19) );

	GetDlgItem( IDC_STATIC_SQLITE )->SetWindowText( str );
	
	return TRUE;
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


void CAboutDlg::OnStatic()
{
	// TODO: Add your command handler code here
}
